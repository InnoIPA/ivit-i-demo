FROM ubuntu:focal
USER root

# Setup Arguments
ARG VER
ARG GITHUB_USER
ARG GITHUB_TOKEN

# Setup Environment
ENV DEBIAN_FRONTEND=noninteractive
ENV REPO=https://github.com/InnoIPA/ivit-i-demo.git
ENV WS=/opt/inno
ENV IVIT=ivit-i-demo

# Download Repository
WORKDIR $WS
RUN apt-get update -q \
    && apt-get install -qqy git ssh openssh-server \
    && git config --system credential.helper store \
    && echo "https://${GITHUB_USER}:${GITHUB_TOKEN}@github.com" > ~/.git-credentials \
    && git clone ${REPO} --branch ${VER}


# Install packages and Remove cache and file
WORKDIR $WS/$IVIT
RUN ${WS}/${IVIT}/docker/requirements.sh \
    && unzip ${WS}/${IVIT}/static/vendor.zip \
    && rm -rf $WS/$IVIT/docker \
    && rm -rf $WS/$IVIT/.git \
    && rm $WS/$IVIT/package_vendor.sh

ENTRYPOINT [ "/bin/bash", "-c" ]

# docker run --name ivit-i-demo-test --rm -it --net=host --ipc=host maxchanginnodisk/ivit-i-demo:v0.8 "./demo.sh"