FROM ubuntu:focal
USER root

# Setup Arguments
ARG VER
ARG GITHUB_USER
ARG GITHUB_TOKEN

# Setup Environment
ENV DEBIAN_FRONTEND noninteractive
ENV REPO=https://github.com/InnoIPA/ivit-i-demo.git
ENV WS=/workspace

# Switch to work directory
WORKDIR ${WS}

# Download Repository
RUN apt-get update -q \
&& apt-get install -qqy git ssh openssh-server jq boxes \
&& git config --system credential.helper store \
&& echo "https://${GITHUB_USER}:${GITHUB_TOKEN}@github.com" > ~/.git-credentials \
&& git clone ${REPO} --branch ${VER} \
&& mv -f ${IVIT} ${WS}

# Install requirments
RUN apt-get -y install python3-dev python3-pip \
&& apt-get install boxes tree jq bsdmainutils -yq \
&& pip3 install -r ${WS}/docker/py-requirements.txt

ENTRYPOINT [ "/bin/bash", "-c" ]
